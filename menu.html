
<!doctype html> 
<html lang="en"> 
<head> 
    <meta charset="UTF-8" />
    <title>Juego Educativo</title>       
    <link rel="stylesheet" href="styles/style_index.css">       
    <script src="js/acorn_interpreter.js"></script>    
    <!-- Se carga el espacio de trabajo de tamaño fijo -->
    <script src="node_modules/blockly/blockly_compressed.js"></script>
    <script src="node_modules/blockly/blocks_compressed.js"></script>
    <!-- Se carga generador de código para javascript-->
    <script src="node_modules/blockly/javascript_compressed.js"></script>
    <!-- Se carga el idioma de los bloques -->
    <script src="node_modules/blockly/msg/es.js"></script>   
    <!-- Seteo los movimientos a traves de los bloques --> 
    <script src="js/movement_block.js"></script>
    <script src="js/movement_stub.js"></script>

    <script src="node_modules/phaser/dist/phaser.js"></script>    
    <!-- Declaro el javascript que contiene la inicialización de blockly -->
    <script src="js/init_blockly.js"></script> 
    <script src="node_modules/jquery/dist/jquery.min.js"></script>     
    <script src="levels/menu.js"></script>  
    <script src="levels/lv1.js"></script>  
</head>
<body>
    
    <div id="blocklyDiv" class="centerBlocklyDiv"></div>
    <textarea id="blocklyTextId" class="blocklyText"></textarea>
    <div id="gameRight" class="centergame"></div>
    <xml id='toolbox' style='display: none'> 
        <category name="Iterador" toolboxitemid="loop_for" colour="#5CA65C">
            <block type="controls_repeat_ext">
              <value name="TIMES">
                <shadow type="math_number">
                  <field name="NUM">10</field>
                </shadow>
              </value>
            </block>
        </category>       
          <category name='movimientos' toolboxitemid="movement_sprite" colour='#a55b6d'>
              <block type='move_right'></block>
              <block type='move_left'></block>
              <block type='move_down'></block>
              <block type='move_up'></block>
            </category>
      </xml>      
      <xml id='startBlocks' style='display: none'></xml>
    
<script type="text/javascript">



var score = "menu";
var widthGame = 800;
var hightGame = 480;
// ubicacion sprite al comienzo
var sprite;
//inicia tablero 195 es el valor de height + 5 por un defasaje
var horizontal = widthGame - (( widthGame / 2 ) / 2);
var vertical = hightGame - ((hightGame - (195 + 5)) / 2);
var width = widthGame / 2;
var hight = hightGame - (195 + 5);
var cantCellVertical = 6;
var cantCellHorizontal = 5;
var cellWidth = width / cantCellVertical;
var cellhight = hight / cantCellHorizontal;
// ubicacion sobre el eje Y de los botones que ejecutan las acciones
var posYExecutables = hightGame - (cellhight / 2);
var posXExecutables = cellWidth / 2;
// posicion de sprite de inicio
const initPosX = width + (cellWidth / 2);
const initPosY = hightGame - (cellhight / 2);
// movimiento en tablero
const moveX = cellWidth;
const moveY = cellhight;
// sector botones
var playButton;
var resetButton;
var menuButton;

// posicion variale del sprite
var posX;
var posY;
// linea de movimientos animados y avance
var timeline;

// tiempo del sprite para moverse de "a" a "b"
var tiempoSprite = 1000;
// Título de juego terminado
var title;

var titleOutTable;
// Título de juego teminado.
var titleGameComplete;

var cantStars = 1;
var star;
var yo;

inject_blockly();
// Menú principal

function ocultarBloques(){
    $("#blocklyDiv").hide();
    $("#blocklyTextId").hide();
}

function mostrarBloques(){    
    $("#blocklyDiv").show();
    $("#blocklyTextId").show();
}

function ocultarCategorias(){
    demoWorkspace.getToolbox().getToolboxItemById('loop_for').hide();
}

ocultarCategorias();

ocultarBloques();

var config = {
    type: Phaser.AUTO,
    /* dom: {
        createContainer: true
    }, */
    scale: {
        width: 800,
        height: 480,
        mode: Phaser.Scale.FIT,
        parent: document.getElementById("gameRight"),
        autoCenter: Phaser.Scale.CENTER_BOTH,        
    },    
    physics: {
        default: 'arcade',
        arcade: {
            //gravity: { y: -300 },
            debug: false
        }
    },  
    scene: [ SceneMenu, SceneA ]
};
// declaro la creacion del juego
var game = new Phaser.Game(config);

function spriteRight(){
    timeline.add({
        targets: sprite,        
        x: {
            getEnd: function (sprite, key, value)
            {                                
                posX += moveX;                
                return posX;
            },
            getStart: function (sprite, key, value)
            {                     
                sprite.anims.play('right');                            
                return posX;
            }
        },
        ease: 'Power1',
        duration: tiempoSprite
    });
}

function spriteLeft(){
    
    timeline.add({
        targets: sprite,              
        x: {
            getEnd: function (sprite, key, value)
            {                                
                posX -= moveX;                
                return posX;
            },
            getStart: function (sprite, key, value)
            {          
                sprite.anims.play('left');                      
                return posX;
            }
        },
        ease: 'Power1',
        duration: tiempoSprite
    });
}

function spriteUp(){
    
    timeline.add({
        targets: sprite,              
        y: {
            getEnd: function (sprite, key, value)
            {                                
                posY -= moveY;                
                return posY;
            },
            getStart: function (sprite, key, value)
            {          
                sprite.anims.play('turn');                      
                return posY;
            }
        },
        ease: 'Power1',
        duration: tiempoSprite
    });
}

function spriteDown(){
    
    timeline.add({
        targets: sprite,              
        y: {
            getEnd: function (sprite, key, value)
            {                                
                posY += moveY;                
                return posY;
            },
            getStart: function (sprite, key, value)
            {          
                sprite.anims.play('turn');                      
                return posY;
            }
        },        
        ease: 'Power1',
        duration: tiempoSprite
    });
}

function collectStar (sprite, star)
{
    cantStars--;
    if(cantStars === 0){
        star.disableBody(false, true);        
        titleGameComplete.visible = true;    
    }    
}

</script>
</body>
</html>
